<HTML>
<HEAD>
<TITLE>ARM Tool Chain Build Notes</TITLE>
</HEAD>
<H1>ARM Tool Chain Build Notes</H1>
<HR>
This document is a supplement to the instructions found in this
<A HREF=http://www.armlinux.org/docs/toolchain/>document</A>. It is assumed that
the reader is familiar with building programs using configure and other GNU
tools. The commands indicated were executed in a <B>csh</B> session. Adjust
accordingly if you are using a different shell.
<HR>
<P>
Create a "destination" directory for your toolchain. Example:
<TT>/usr/local/arm_tools</TT>
<P>
Create a build directory and "unpack" each of the tools and create a separate
directory for each one to compile it in. For example, create subdirectories
within the build directory named <I>binutils_build, gcc_build, and glibc_build.
</I>
<P>
For each component listed below, cd to the appropriate "working" directory
before executing the configure and make commands.
<P>
<CENTER>***** BINUTILS ******</CENTER>
<P>
<TT>
../binutils-2.12/configure --disable-nls --prefix=/usr/local/arm_tools --target=arm-linux -v >& configure.out
</TT>
<P>
<CENTER>***** GCC (First pass) ******</CENTER>
<P>
<TT>
../gcc-3.0.4/configure --prefix=/usr/local/arm_tools --target=arm-linux -v --with-headers=/usr/local/src/arm/linux/include --disable-nls --enable-languages=c --disable-threads --with-cpu=strongarm110 --disable-shared >& configure.out
</TT>
<P>
<CENTER>***** GLIBC *****</CENTER>
<P>
Apply the following patch if you are using glibc-2.2.5:
<P>
<TT>
diff -ubr glibc-2.2.5.orig/sysdeps/generic/unwind-dw2.c glibc-2.2.5/sysdeps/generic/unwind-dw2.c<BR>
--- glibc-2.2.5.orig/sysdeps/generic/unwind-dw2.c Tue Jan  8 01:30:43 2002<BR>
+++ glibc-2.2.5/sysdeps/generic/unwind-dw2.c Wed Jan 23 15:03:18 2002<BR>
@@ -25,6 +25,7 @@<BR>
#include <libintl.h><BR>
#include <dwarf2.h><BR>
#include <unwind.h><BR>
+#define NO_BASE_OF_ENCODED_VALUE<BR>
#include <unwind-pe.h><BR>
#include <unwind-dw2-fde.h><BR>
#else<BR>
diff -ubr glibc-2.2.5.orig/sysdeps/generic/unwind-pe.h glibc-2.2.5/sysdeps/generic/unwind-pe.h<BR>
--- glibc-2.2.5.orig/sysdeps/generic/unwind-pe.h Thu Nov 15 20:19:30 2001<BR>
+++ glibc-2.2.5/sysdeps/generic/unwind-pe.h Wed Jan 23 15:13:47 2002<BR>
@@ -83,15 +83,19 @@<BR>
}<BR>
#endif<BR>
<BR>
-#ifndef NO_BASE_OF_ENCODED_VALUE<BR>
-<BR>
/* Given an encoding and an _Unwind_Context, return the base to which<BR>
   the encoding is relative.  This base may then be passed to<BR>
   read_encoded_value_with_base for use when the _Unwind_Context is<BR>
   not available.  */<BR>
<BR>
-static _Unwind_Ptr<BR>
+#ifndef _LIBC<BR>
+static<BR>
+#endif<BR>
+_Unwind_Ptr<BR>
base_of_encoded_value (unsigned char encoding, struct _Unwind_Context *context)<BR>
+#if defined(_LIBC) && !defined(NO_BASE_OF_ENCODED_VALUE)<BR>
+;<BR>
+#else<BR>
{<BR>
  if (encoding == DW_EH_PE_omit)<BR>
    return 0;<BR>
@@ -238,14 +242,18 @@<BR>
}<BR>
#endif<BR>
<BR>
-#ifndef NO_BASE_OF_ENCODED_VALUE<BR>
-<BR>
/* Like read_encoded_value_with_base, but get the base from the context<BR>
   rather than providing it directly.  */<BR>
<BR>
-static inline const unsigned char *<BR>
+#ifndef _LIBC<BR>
+static<BR>
+#endif<BR>
+inline const unsigned char *<BR>
read_encoded_value (struct _Unwind_Context *context, unsigned char encoding,<BR>
   const unsigned char *p, _Unwind_Ptr *val)<BR>
+#if defined(_LIBC) && !defined(NO_BASE_OF_ENCODED_VALUE)<BR>
+;<BR>
+#else<BR>
{<BR>
  return read_encoded_value_with_base (encoding,<BR>
base_of_encoded_value (encoding, context),<BR>
diff -ubr glibc-2.2.5.orig/sysdeps/unix/sysv/linux/configure.in glibc-2.2.5/sysdeps/unix/sysv/linux/configure.in<BR>
--- glibc-2.2.5.orig/sysdeps/unix/sysv/linux/configure.in Sun Jan 20 22:26:31 2002<BR>
+++ glibc-2.2.5/sysdeps/unix/sysv/linux/configure.in Wed Jan 23 13:48:56 2002<BR>
@@ -43,6 +43,10 @@<BR>
    arch_minimum_kernel=2.1.100<BR>
    libc_cv_gcc_unwind_find_fde=yes<BR>
   ;;<BR>
+  arm*)<BR>
+    arch_minimum_kernel=2.4.0<BR>
+    libc_cv_gcc_unwind_fine_fde=yes<BR>
+    ;;<BR>
  i386*)<BR>
    libc_cv_gcc_unwind_find_fde=yes<BR>
    arch_minimum_kernel=2.0.10:<BR>
</TT>
<P>
setenv CC arm-linux-gcc
<P>
<TT>
../glibc-2.2.5/configure arm-arm-linux --prefix=/usr/local/arm_tools/arm-linux --enable-add-ons --disable-debug --disable-profile -v >& configure.out
</TT>
<P>
Run 'make install' twice
<P>
<CENTER>***** GCC (Second pass) ******</CENTER>
<P>
If you only need (or care about) C and C++ support:
<P>
<TT>
../gcc-3.0.4/configure --prefix=/usr/local/arm_tools --target=arm-linux -v --with-headers=/usr/local/src/arm/linux/include --disable-nls --enable-languages=c,c++ --with-cpu=strongarm110 --enable-threads=posix >& configure.out
</TT>
<P>
Otherwise, you will need to make the following changes in order to get Java
(gcj) support to work. If you need FORTRAN or ObjectiveC support, you're on your
own! <I><B>NOTE: </B>These changes were necessary for the version of gcc
indicated. They may or may not still be necessary.</I>
<P>
Apply the following change to gcc-3.0.4/libffi/configure.in and run 'autoconf'
<P>
<TT>
82,88c82,89<BR>
< AC_CHECK_SIZEOF(short)<BR>
< AC_CHECK_SIZEOF(int)<BR>
< AC_CHECK_SIZEOF(long)<BR>
< AC_CHECK_SIZEOF(long long)<BR>
< AC_CHECK_SIZEOF(float)<BR>
< AC_CHECK_SIZEOF(double)<BR>
< AC_CHECK_SIZEOF(long double)<BR>
---<BR>
> AC_CHECK_SIZEOF(short,2)<BR>
> AC_CHECK_SIZEOF(int,4)<BR>
> AC_CHECK_SIZEOF(long,4)<BR>
> AC_CHECK_SIZEOF(long long,8)<BR>
> AC_CHECK_SIZEOF(float,4)<BR>
> AC_CHECK_SIZEOF(double,8)<BR>
> dnl AC_CHECK_SIZEOF(long double)<BR>
> AC_CHECK_SIZEOF(void *,4)<BR>
90,91c91<BR>
< AC_CHECK_SIZEOF(void *)<BR>
< AC_C_BIGENDIAN<BR>
---<BR>
> dnl AC_C_BIGENDIAN<BR>
</TT>
<P>
Apply the following change to gcc-3.0.4/libjava/java/net/natInetAddress.cc
<P>
Replace -
<P>
extern "C" int gethostname (char *name, int namelen);
<P>
With -
<P>
extern "C" int gethostname (char *name, unsigned int namelen);
<P>
Apply the following change to gcc-3.0.4/libjava/configure
<P>
1673,1678c1673,1680<BR>
< if test -z "${with_cross_host}"; then<BR>
<      case $enable_ltdl_convenience in<BR>
<   no) { echo "configure: error: this package needs a convenience libltdl" 1>&2; exit 1; } ;;<BR>
<   "") enable_ltdl_convenience=yes<BR>
<       ac_configure_args="$ac_configure_args --enable-ltdl-convenience" ;;<BR>
<   esac<BR>
---<BR>
> #if test -z "${with_cross_host}"; then<BR>
> #     case $enable_ltdl_convenience in<BR>
> #  no) { echo "configure: error: this package needs a convenience libltdl" 1>&2; exit 1; } ;;<BR>
> #  "")<BR>
>  enable_ltdl_convenience=yes<BR>
>       ac_configure_args="$ac_configure_args --enable-ltdl-convenience"<BR>
> # ;;<BR>
> #  esac<BR>
1693c1695<BR>
< fi<BR>
---<BR>
> #fi<BR>
<P>
<TT>
../gcc-3.0.4/configure --prefix=/usr/local/arm_tools --target=arm-linux -v --with-headers=/usr/local/src/arm/linux/include --disable-nls --enable-languages=c,c++,java --with-cpu=strongarm110 --enable-threads=posix --enable-java-gc=boehm --enable-ltdl-install > & configure.out
</TT>
<HR>
